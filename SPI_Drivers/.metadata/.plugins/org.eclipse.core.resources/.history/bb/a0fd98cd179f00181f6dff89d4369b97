
#include "hal_spi_driver.h"
#include "stm32f4xx_gpio_driver.h"

#define BYTES_TO_READ		 	0x6
#define ADX_PIN					10
//#define CS
#define ADXL345_DATAX0			0x32		// X-Axis Data 0
#define ADXL345_DATAX1			0x33		// X-Axis Data 1
#define ADXL345_DATAY0			0x34		// Y-Axis Data 0
#define ADXL345_DATAY1			0x35		// Y-Axis Data 1
#define ADXL345_DATAZ0			0x36		// Z-Axis Data 0
#define ADXL345_DATAZ1			0x37		// Z-Axis Data 1

uint8_t buffer[6];

void readFrom(uint8_t address, int bytes_to_read, uint8_t buff[]){
	address |= 0x80;		// Enable READ bit
	//MB = 0 	-- read 1 byte

	hal_gpio_write_to_pin(PORTC, 0, ADX_PIN);

	tx_handler(&spiHandle, address, 1);
}

void readAccel(int *x, int *y, int *z){
	readFrom(ADXL345_DATAX0, BYTES_TO_READ, buffer);
}
